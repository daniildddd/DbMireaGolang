# Руководство по использованию Query Builder

## Архитектура приложения

```
┌─────────────────────────────────────────────────────────────┐
│                    SQL Query Builder                        │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────────────────────────────────────────────┐  │
│  │           Filter Selection Grid                      │  │
│  │  (Выбор таблицы, фильтры, сортировка, группировка) │  │
│  └──────────────────────────────────────────────────────┘  │
│                           ↓                                 │
│  ┌──────────────────────────────────────────────────────┐  │
│  │         Generated SQL Display Component              │  │
│  │         (Показывает сгенерированный SQL)             │  │
│  │         [Выполнить] Button ←─ onExecute callback   │  │
│  └──────────────────────────────────────────────────────┘  │
│                           ↓                                 │
│  ┌──────────────────────────────────────────────────────┐  │
│  │              ApiMiddleware Layer                      │  │
│  │     (Wails bindings to Go backend methods)            │  │
│  └──────────────────────────────────────────────────────┘  │
│                           ↓                                 │
│  ┌──────────────────────────────────────────────────────┐  │
│  │          Backend (Go/Wails)                           │  │
│  │  ExecuteCustomQuery() → SQL Execution → Results       │  │
│  └──────────────────────────────────────────────────────┘  │
│                           ↓                                 │
│  ┌──────────────────────────────────────────────────────┐  │
│  │          Query Results Component                      │  │
│  │  (Профессиональная таблица с результатами)            │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

## Пошаговое использование

### Шаг 1: Выбор таблицы

```
1. Откройте вкладку "Фильтрация" в приложении
2. В левой панели выберите таблицу из выпадающего списка
3. Приложение автоматически загрузит схему выбранной таблицы
```

### Шаг 2: Создание WHERE фильтров (Опционально)

```
1. Нажмите кнопку "WHERE" в Filter Selection Grid
2. В модальном окне:
   - Выберите поле (dropdown с полями таблицы)
   - Выберите оператор (=, <>, <, >, <=, >=)
   - Введите значение для сравнения
   - Нажмите "Добавить условие" для добавления ещё одного
3. Нажмите "Применить" или крестик для закрытия
4. Условие добавится в финальный SQL
```

### Шаг 3: Добавление GROUP BY (Опционально)

```
1. Нажмите кнопку "GROUP BY" в Filter Selection Grid
2. В модальном окне:
   - Выберите поля для группировки из списка
   - Нажимайте "Добавить" для каждого поля
   - Нажмите "Удалить" если хотите убрать поле
3. Нажмите "Применить"
4. Возникнет SQL: SELECT ... GROUP BY field1, field2, ...
```

### Шаг 4: Добавление функций агрегации (При GROUP BY)

```
1. Нажмите кнопку "AGGREGATE" в Filter Selection Grid
2. В модальном окне:
   - Выберите поле для агрегации
   - Выберите функцию (COUNT, SUM, AVG, MIN, MAX)
   - Введите псевдоним (ALIAS) для результата
   - Нажмите "Добавить"
3. Нажмите "Применить"
4. Возникнет SQL: SELECT field, COUNT(field) as alias, ...
```

### Шаг 5: Добавление HAVING фильтров (При GROUP BY)

```
1. Нажмите кнопку "HAVING" в Filter Selection Grid
2. Работает аналогично WHERE, но для агрегатных функций
3. Пример: COUNT(id) > 5
4. Нажмите "Применить"
```

### Шаг 6: Добавление ORDER BY (Опционально)

```
1. Нажмите кнопку "ORDER BY" в Filter Selection Grid
2. В модальном окне:
   - Выберите поле для сортировки
   - Выберите направление (ASC - возрастание, DESC - убывание)
   - Нажмите "Добавить" для каждого поля
3. Нажмите "Применить"
4. Возникнет SQL: SELECT ... ORDER BY field1 ASC, field2 DESC, ...
```

### Шаг 7: Добавление CASE/WHEN выражений (Опционально)

```
1. Нажмите кнопку "CASE" в Filter Selection Grid
2. В модальном окне добавьте WHEN-THEN пары:
   - Поле: выберите поле для проверки (dropdown)
   - Оператор: выберите оператор сравнения (dropdown)
   - Значение: введите значение для сравнения
   - Результат: введите значение для возврата
   - Затем щелкните "Добавить пару"
3. Введите значение по умолчанию (ELSE)
4. Нажмите "Применить"
5. Возникнет SQL: SELECT CASE WHEN field > value THEN result ...
```

### Шаг 8: Добавление подзапросов (Опционально)

```
1. Нажмите кнопку "Подзапрос" в Filter Selection Grid
2. В модальном окне:
   - Отметьте "Коррелированный подзапрос" если нужно
   - Выберите тип подзапроса (IN, NOT IN, EXISTS, NOT EXISTS)
   - Выберите подзапрос из списка доступных подзапросов
   - Выберите поле для сравнения (если требуется)
   - Выберите оператор сравнения (если требуется)
   - Отметьте "Добавить WHERE условие" если нужны дополнительные фильтры
3. Нажмите "Применить"
4. Подзапрос интегрируется в основной запрос
```

### Шаг 9: Просмотр сгенерированного SQL

```
1. Вся конфигурация отображается в компоненте "Итоговый SQL:"
2. Там видна полная SQL команда которая будет выполнена
3. Вы можете её скопировать, если нужно
```

### Шаг 10: Выполнение запроса

```
1. После настройки всех фильтров нажмите кнопку "Выполнить"
2. Приложение покажет "Выполнение..." во время обработки
3. Результаты появятся в таблице ниже
4. Таблица содержит:
   - Номер строки (#)
   - Все столбцы из результата
   - Количество найденных записей вверху таблицы
   - Null значения отображаются как "NULL"
   - Булевы значения отображаются как "true"/"false"
```

## Компоненты модалей

### WHERE Modal

- Поля: Field (dropdown), Operator (dropdown), Value (текст)
- Добавляет условие WHERE к запросу
- Поддерживает несколько условий с логикой AND
- Операторы: =, <>, <, >, <=, >=

### GROUP BY Modal

- Выбор полей для группировки
- Список выбранных полей
- Кнопки добавления/удаления

### AGGREGATE Modal

- Field: поле для функции (dropdown)
- Function: COUNT, SUM, AVG, MIN, MAX (dropdown)
- Alias: имя для результата (текст)
- Требует наличия GROUP BY

### HAVING Modal

- Аналогичен WHERE
- Применяется к агрегатным функциям
- Требует наличия GROUP BY и AGGREGATE

### ORDER BY Modal

- Field: поле для сортировки (dropdown)
- Direction: ASC (возрастание) или DESC (убывание)
- Поддерживает множественную сортировку

### CASE Modal

- WHEN-THEN пары для условной логики
- Каждая пара:
  - Field: какое поле проверять
  - Operator: оператор сравнения
  - Value: значение для сравнения
  - Result: что вернуть если условие верно
- ELSE: значение по умолчанию

### Subquery Modal

- Subquery Type: IN, NOT IN, EXISTS, NOT EXISTS
- Comparison Field: для IN/NOT IN (dropdown)
- Operator: оператор сравнения
- Subquery Table: таблица для подзапроса
- Select Field: какое поле выбирать из подзапроса
- Correlated: флаг для коррелированных подзапросов

## Примеры использования

### Пример 1: Простой SELECT

```
Таблица: users
Результат SQL: SELECT * FROM users
```

### Пример 2: SELECT с WHERE

```
Таблица: users
WHERE: age > 18
Результат SQL: SELECT * FROM users WHERE age > 18
```

### Пример 3: Агрегация

```
Таблица: orders
GROUP BY: category
AGGREGATE: COUNT(id) as total_orders
Результат SQL: SELECT category, COUNT(id) as total_orders FROM orders GROUP BY category
```

### Пример 4: Сложный запрос

```
Таблица: customers
WHERE: status = 'active'
GROUP BY: country
AGGREGATE: COUNT(id) as customer_count, SUM(total) as total_spent
HAVING: COUNT(id) > 5
ORDER BY: total_spent DESC
Результат SQL:
SELECT country, COUNT(id) as customer_count, SUM(total) as total_spent
FROM customers
WHERE status = 'active'
GROUP BY country
HAVING COUNT(id) > 5
ORDER BY total_spent DESC
```

## Обработка результатов

### Результаты отображаются в таблице:

```
┌────┬─────────────────────────────────────────────────────┐
│ #  │ column1  │ column2  │ column3  │ ... │             │
├────┼──────────┼──────────┼──────────┼─────┤             │
│ 1  │ value1   │ value2   │ value3   │ ... │             │
│ 2  │ value1   │ value2   │ value3   │ ... │             │
│ 3  │ NULL     │ value2   │ value3   │ ... │             │
└────┴──────────┴──────────┴──────────┴─────┴─────────────┘
Найдено записей: 3
```

### Специальные значения:

- `NULL` - значение NULL в БД
- `true/false` - булевы значения
- JSON объекты отображаются как JSON строка

## Обработка ошибок

Если запрос содержит ошибку:

```
⚠️  Ошибка запроса:
Ошибка синтаксиса SQL: ...
(детальное описание ошибки)
```

Возможные ошибки:

- Синтаксис SQL
- Неверное имя поля/таблицы
- Неподдерживаемая операция
- Проблема с подключением к БД

## Советы и трюки

1. **Построение сложных запросов:**

   - Начните с простого SELECT
   - Постепенно добавляйте фильтры WHERE
   - Затем GROUP BY с AGGREGATE
   - Завершите ORDER BY

2. **Проверка SQL:**

   - Всегда смотрите на "Итоговый SQL:" перед выполнением
   - Убедитесь что синтаксис правильный

3. **Оптимизация:**

   - Используйте WHERE для фильтрации по возможности
   - HAVING работает медленнее чем WHERE
   - Избегайте ненужных ORDER BY

4. **Отладка:**
   - Если запрос не работает - проверьте SQL
   - Используйте небольшие наборы данных для тестирования
   - Проверьте названия полей/таблиц

## Нужна помощь?

- Проверьте синтаксис SQL в "Итоговом SQL:"
- Убедитесь что выбраны правильные таблицы/поля
- Попробуйте более простой запрос
- Проверьте типы данных в выбранных полях
